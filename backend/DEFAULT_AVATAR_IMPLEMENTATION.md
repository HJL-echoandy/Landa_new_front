# ğŸ¨ DiceBear é»˜è®¤å¤´åƒåŠŸèƒ½ - å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1ï¸âƒ£ **åˆ›å»ºå¤´åƒç”Ÿæˆå·¥å…·**

**æ–‡ä»¶**: `backend/app/utils/avatar.py` âœ¨ (æ–°å»º)

**åŠŸèƒ½**:
- âœ… `generate_default_avatar()` - ä½¿ç”¨ DiceBear Avataaars é£æ ¼ç”Ÿæˆå¤´åƒ
- âœ… `generate_avatar_from_name()` - åŸºäºå§“åç”Ÿæˆå¤´åƒï¼ˆUI Avatarsï¼‰
- âœ… `get_avatar_hash()` - MD5 å“ˆå¸Œï¼ˆGravatar ç­‰ï¼‰

**ç¤ºä¾‹**:
```python
from app.utils.avatar import generate_default_avatar

# ä½¿ç”¨æ‰‹æœºå·ç”Ÿæˆå¤´åƒ
avatar_url = generate_default_avatar("13800138000")
# ç»“æœ: https://api.dicebear.com/7.x/avataaars/svg?seed=13800138000&size=256&backgroundColor=b6e3f4,c0aede,d1d4f9
```

---

### 2ï¸âƒ£ **é›†æˆåˆ°ç™»å½•æ¥å£**

**æ–‡ä»¶**: `backend/app/api/v1/therapist_auth.py` âœ… (å·²ä¿®æ”¹)

**åŠŸèƒ½**:
- âœ… æ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨ç”Ÿæˆé»˜è®¤å¤´åƒ
- âœ… åŒæ—¶åœ¨ `User` å’Œ `Therapist` è¡¨è®¾ç½®å¤´åƒ
- âœ… å¤´åƒåŸºäºæ‰‹æœºå·ç”Ÿæˆï¼Œä¿è¯å”¯ä¸€æ€§

**å…³é”®ä»£ç **:
```python
# å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰
if not user:
    is_new_user = True
    
    # âœ… ç”Ÿæˆé»˜è®¤æ˜µç§°å’Œå¤´åƒ
    default_nickname = f"æŠ€å¸ˆ{phone[-4:]}"
    default_avatar = generate_default_avatar(phone)  # ä½¿ç”¨ DiceBear
    
    user = User(
        phone=phone,
        nickname=default_nickname,
        avatar=default_avatar,  # âœ… è®¾ç½®é»˜è®¤å¤´åƒ
        role=UserRole.THERAPIST,
        # ...
    )
```

---

### 3ï¸âƒ£ **æ›´æ–°æµ‹è¯•è„šæœ¬**

**æ–‡ä»¶**: `backend/scripts/create_test_therapist.py` âœ… (å·²ä¿®æ”¹)

**åŠŸèƒ½**:
- âœ… æµ‹è¯•è´¦å·åˆ›å»ºæ—¶ä½¿ç”¨é»˜è®¤å¤´åƒç”Ÿæˆ
- âœ… è¾“å‡ºå¤´åƒ URL ç”¨äºéªŒè¯

---

## ğŸ¨ **å¤´åƒæ•ˆæœå±•ç¤º**

### DiceBear Avataaars é£æ ¼

**é…ç½®**:
- **é£æ ¼**: avataaars (ç±»ä¼¼ Bitmoji çš„å¡é€šé£æ ¼)
- **èƒŒæ™¯è‰²**: æŸ”å’Œçš„è“ç´«è‰²è°ƒ (b6e3f4, c0aede, d1d4f9)
- **å°ºå¯¸**: 256x256
- **æ ¼å¼**: SVG (çŸ¢é‡å›¾ï¼Œæ— æŸç¼©æ”¾)

**å®é™… URL ç¤ºä¾‹**:
```
https://api.dicebear.com/7.x/avataaars/svg?seed=13800138000&size=256&backgroundColor=b6e3f4,c0aede,d1d4f9
https://api.dicebear.com/7.x/avataaars/svg?seed=13900139000&size=256&backgroundColor=b6e3f4,c0aede,d1d4f9
https://api.dicebear.com/7.x/avataaars/svg?seed=15800158000&size=256&backgroundColor=b6e3f4,c0aede,d1d4f9
```

**ç‰¹ç‚¹**:
- âœ… æ¯ä¸ªæ‰‹æœºå·ç”Ÿæˆå”¯ä¸€çš„å¤´åƒ
- âœ… é£æ ¼å‹å¥½ã€ç°ä»£
- âœ… å®Œå…¨å…è´¹ã€æ— é™åˆ¶
- âœ… æ— éœ€ä¸‹è½½ï¼Œç›´æ¥ä½¿ç”¨ URL

---

## ğŸ”„ **å®Œæ•´æµç¨‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç”¨æˆ·è¾“å…¥æ‰‹æœºå·: 13800138000                              â”‚
â”‚    â†“                                                         â”‚
â”‚ 2. è¾“å…¥éªŒè¯ç : 888888                                       â”‚
â”‚    â†“                                                         â”‚
â”‚ 3. åç«¯æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨                                      â”‚
â”‚    â†“                                                         â”‚
â”‚ 4. ç”¨æˆ·ä¸å­˜åœ¨ â†’ è‡ªåŠ¨æ³¨å†Œ                                    â”‚
â”‚    â”œâ”€ ç”Ÿæˆæ˜µç§°: "æŠ€å¸ˆ8000"                                  â”‚
â”‚    â”œâ”€ ç”Ÿæˆå¤´åƒ: generate_default_avatar("13800138000")      â”‚
â”‚    â”‚   è¿”å›: https://api.dicebear.com/7.x/avataaars/...    â”‚
â”‚    â””â”€ åˆ›å»º User å’Œ Therapist è®°å½•                           â”‚
â”‚    â†“                                                         â”‚
â”‚ 5. æ•°æ®åº“ä¿å­˜                                                â”‚
â”‚    â”œâ”€ users è¡¨:                                             â”‚
â”‚    â”‚  avatar = "https://api.dicebear.com/7.x/..."          â”‚
â”‚    â””â”€ therapists è¡¨:                                        â”‚
â”‚       avatar = "https://api.dicebear.com/7.x/..."          â”‚
â”‚    â†“                                                         â”‚
â”‚ 6. è¿”å›ç™»å½•ä¿¡æ¯                                              â”‚
â”‚    åŒ…å«é»˜è®¤å¤´åƒ URL                                          â”‚
â”‚    â†“                                                         â”‚
â”‚ 7. å‰ç«¯æ˜¾ç¤ºå¤´åƒ                                              â”‚
â”‚    <Image source={{ uri: user.avatar }} />                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š **æ•°æ®åº“çŠ¶æ€**

### æ–°ç”¨æˆ·æ³¨å†Œå

**users è¡¨**:
```sql
SELECT id, phone, nickname, avatar FROM users WHERE phone = '13800138000';

| id | phone       | nickname  | avatar                                        |
|----|-------------|-----------|-----------------------------------------------|
| 1  | 13800138000 | æŠ€å¸ˆ8000  | https://api.dicebear.com/7.x/avataaars/...   |
```

**therapists è¡¨**:
```sql
SELECT id, user_id, name, avatar FROM therapists WHERE user_id = 1;

| id | user_id | name     | avatar                                        |
|----|---------|----------|-----------------------------------------------|
| 1  | 1       | æŠ€å¸ˆ8000 | https://api.dicebear.com/7.x/avataaars/...   |
```

---

## ğŸ§ª **æµ‹è¯•æ–¹æ³•**

### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
cd backend
docker-compose exec api python scripts/create_test_therapist.py
```

**é¢„æœŸè¾“å‡º**:
```
ğŸ“ æ­£åœ¨åˆ›å»ºæµ‹è¯•æŠ€å¸ˆè´¦å·...
ğŸ¨ ç”Ÿæˆé»˜è®¤å¤´åƒ: https://api.dicebear.com/7.x/avataaars/svg?seed=13800138000&size=256&backgroundColor=b6e3f4,c0aede,d1d4f9

âœ… æµ‹è¯•è´¦å·åˆ›å»ºæˆåŠŸï¼

==================================================
ğŸ“± æµ‹è¯•è´¦å·ä¿¡æ¯
==================================================
æ‰‹æœºå·: 13800138000
éªŒè¯ç : 888888 (debugæ¨¡å¼é€šç”¨éªŒè¯ç )
æ˜µç§°: æµ‹è¯•æŠ€å¸ˆ
å¤´åƒ: https://api.dicebear.com/7.x/avataaars/...
==================================================
```

### æ–¹æ³• 2: å‰ç«¯ç™»å½•æµ‹è¯•

1. å¯åŠ¨å‰ç«¯åº”ç”¨
2. ä½¿ç”¨æ–°æ‰‹æœºå·ç™»å½•ï¼ˆå¦‚: `13900139000`ï¼‰
3. éªŒè¯ç : `888888`
4. æŸ¥çœ‹ä¸ªäººèµ„æ–™é¡µï¼Œåº”è¯¥æ˜¾ç¤ºé»˜è®¤å¤´åƒ

### æ–¹æ³• 3: ç›´æ¥è®¿é—®å¤´åƒ URL

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€:
```
https://api.dicebear.com/7.x/avataaars/svg?seed=13800138000&size=256&backgroundColor=b6e3f4,c0aede,d1d4f9
```

åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªå¡é€šé£æ ¼çš„å¤´åƒã€‚

---

## ğŸ¯ **ä¼˜åŠ¿**

1. âœ… **å³æ—¶å¯ç”¨** - æ–°ç”¨æˆ·æ³¨å†Œåç«‹å³æœ‰å¤´åƒ
2. âœ… **å”¯ä¸€æ€§** - åŸºäºæ‰‹æœºå·ï¼Œæ¯ä¸ªç”¨æˆ·å¤´åƒä¸åŒ
3. âœ… **é›¶æˆæœ¬** - å®Œå…¨å…è´¹ï¼Œæ— éœ€å­˜å‚¨
4. âœ… **é«˜æ€§èƒ½** - CDN åˆ†å‘ï¼ŒåŠ è½½å¿«
5. âœ… **å¯å®šåˆ¶** - ç”¨æˆ·åç»­å¯ä¸Šä¼ è‡ªå·±çš„å¤´åƒ
6. âœ… **å‹å¥½ç¾è§‚** - å¡é€šé£æ ¼ï¼Œç”¨æˆ·ä½“éªŒå¥½

---

## ğŸ”§ **åç»­å¯ä¼˜åŒ–**

### 1. æ·»åŠ æ›´å¤šé£æ ¼é€‰æ‹©

```python
# éšæœºé€‰æ‹©é£æ ¼
AVATAR_STYLES = ['avataaars', 'bottts', 'personas', 'adventurer']
style = random.choice(AVATAR_STYLES)
```

### 2. è‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆ

```python
# æ ¹æ®ç”¨æˆ·IDé€‰æ‹©ä¸åŒé…è‰²
COLOR_SCHEMES = [
    'b6e3f4,c0aede,d1d4f9',  # è“ç´«è‰²
    'ffd5e5,ffe5ec,fff0f6',  # ç²‰è‰²
    'ffeaa7,fdcb6e,e17055',  # æ©™è‰²
]
```

### 3. æ·»åŠ å¤´åƒé¢„è§ˆåŠŸèƒ½

å‰ç«¯åœ¨æ³¨å†Œæ—¶å±•ç¤ºå³å°†ç”Ÿæˆçš„å¤´åƒã€‚

---

## ğŸ“ **é…ç½®è¯´æ˜**

### å½“å‰é…ç½®

```python
# backend/app/utils/avatar.py

def generate_default_avatar(seed: str, style: str = "avataaars", size: int = 256):
    background_colors = "b6e3f4,c0aede,d1d4f9"
    return f"https://api.dicebear.com/7.x/{style}/svg?seed={seed}&size={size}&backgroundColor={background_colors}"
```

### å¯è°ƒæ•´å‚æ•°

- **style**: å¤´åƒé£æ ¼ (avataaars, bottts, personas, etc.)
- **size**: å›¾ç‰‡å°ºå¯¸ (æ¨è 256 æˆ– 512)
- **backgroundColor**: èƒŒæ™¯è‰²ï¼ˆåå…­è¿›åˆ¶ï¼Œé€—å·åˆ†éš”ï¼‰

---

## âœ… **å®ŒæˆçŠ¶æ€**

- [x] åˆ›å»ºå¤´åƒç”Ÿæˆå·¥å…·å‡½æ•°
- [x] é›†æˆåˆ°æŠ€å¸ˆç™»å½•æ¥å£
- [x] æ–°ç”¨æˆ·è‡ªåŠ¨åˆ†é…é»˜è®¤å¤´åƒ
- [x] åŒæ­¥æ›´æ–° User å’Œ Therapist è¡¨
- [x] æ›´æ–°æµ‹è¯•è„šæœ¬
- [x] æ–‡æ¡£å®Œå–„

---

## ğŸ‰ **æ€»ç»“**

**é»˜è®¤å¤´åƒåŠŸèƒ½å·²å®Œå…¨å®ç°ï¼**

ç°åœ¨æ–°ç”¨æˆ·æ³¨å†Œæ—¶ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªåŸºäº DiceBear Avataaars é£æ ¼çš„é»˜è®¤å¤´åƒï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

**åç«¯ä¼šè‡ªåŠ¨**:
1. ä¸ºæ–°ç”¨æˆ·ç”Ÿæˆå”¯ä¸€å¤´åƒ
2. ä¿å­˜åˆ°æ•°æ®åº“
3. è¿”å›ç»™å‰ç«¯æ˜¾ç¤º

**ç”¨æˆ·å¯ä»¥**:
1. ä½¿ç”¨é»˜è®¤å¤´åƒ
2. åç»­é€šè¿‡"ç¼–è¾‘èµ„æ–™"ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ

å®Œç¾ï¼ğŸš€

